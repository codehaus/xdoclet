<project default="jar:install-snapshot"
    xmlns:j="jelly:core"
    xmlns:maven="jelly:maven">

    <goal name="alljar" prereqs="java:compile" description="Make a big jar with all dependencies">
        <mkdir dir="${maven.build.dir}/alljar"/>

        <j:forEach var="lib" items="${pom.artifacts}">
            <unjar
                dest="${maven.build.dir}/alljar"
                src="${lib.path}"/>
        </j:forEach>

        <copy todir="${maven.build.dir}/alljar">
            <fileset dir="${maven.build.dir}/classes"/>
        </copy>

        <jar
            jarfile="${maven.build.dir}/all-${maven.final.name}.jar"
            basedir="${maven.build.dir}/alljar"
            excludes="overview.html,stylesheet.css,junit/**/*,org/apache/tools/**/*,org/custommonkey/**/*,antlr/**/*,org/jmock/**/*">
            <manifest>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="Package" value="${pom.package}"/>
            </manifest>
        </jar>

    </goal>

</project>